<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Python JSON序列化器深度调研：开箱即用与多类型支持</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Playfair+Display:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            background-color: #f9fafb;
            overflow-x: hidden;
        }
        .serif {
            font-family: 'Playfair Display', serif;
        }
        .toc-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            z-index: 50;
            padding: 2rem 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .content-main {
            margin-left: 280px;
            min-height: 100vh;
            background: white;
        }
        .hero-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
            min-height: 60vh;
        }
        .citation {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px dotted #3b82f6;
        }
        .citation:hover {
            background-color: #eff6ff;
            border-bottom-style: solid;
        }
        .body-text {
            max-width: 4xl;
            margin: 0 auto;
        }
        .toc-link {
            display: block;
            padding: 0.5rem 0;
            color: #4b5563;
            text-decoration: none;
            border-left: 3px solid transparent;
            padding-left: 1rem;
            transition: all 0.2s;
        }
        .toc-link:hover, .toc-link.active {
            color: #1e40af;
            border-left-color: #3b82f6;
            background-color: #eff6ff;
        }
        .toc-link.sub {
            margin-left: 1rem;
            font-size: 0.875rem;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
        }
        .highlight-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #0ea5e9;
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0.375rem;
        }
        .comparison-table {
            overflow-x: auto;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .comparison-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        .comparison-table tr:hover {
            background: #f9fafb;
        }
        
        /* Mermaid diagram styles */
        .mermaid-container {
            display: flex;
            justify-content: center;
            min-height: 300px;
            max-height: 800px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .mermaid-container .mermaid {
            width: 100%;
            max-width: 100%;
            height: 100%;
            cursor: grab;
            transition: transform 0.3s ease;
            transform-origin: center center;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .mermaid-container .mermaid svg {
            max-width: 100%;
            height: 100%;
            display: block;
            margin: 0 auto;
        }

        .mermaid-container .mermaid:active {
            cursor: grabbing;
        }

        .mermaid-container.zoomed .mermaid {
            height: 100%;
            width: 100%;
            cursor: grab;
        }

        .mermaid-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 20;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .mermaid-control-btn {
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #374151;
            font-size: 14px;
            min-width: 36px;
            height: 36px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mermaid-control-btn:hover {
            background: #f8fafc;
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-1px);
        }

        .mermaid-control-btn:active {
            transform: scale(0.95);
        }

        /* Enhanced Mermaid theme with better contrast */
        .mermaid .node rect,
        .mermaid .node circle,
        .mermaid .node ellipse,
        .mermaid .node polygon {
            stroke: #3b82f6 !important;
            stroke-width: 2px !important;
            fill: #dbeafe !important;
        }
        
        .mermaid .node .label {
            color: #1e40af !important;
            font-weight: 500 !important;
            font-size: 14px !important;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .mermaid .edgePath .path {
            stroke: #6b7280 !important;
            stroke-width: 2px !important;
        }
        
        .mermaid .edgeLabel {
            background-color: rgba(255, 255, 255, 0.95) !important;
            color: #374151 !important;
            font-weight: 500 !important;
            font-size: 12px !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            border: 1px solid #e5e7eb !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Different node colors for better visual hierarchy */
        .mermaid .node:nth-child(4n+1) rect,
        .mermaid .node:nth-child(4n+1) circle,
        .mermaid .node:nth-child(4n+1) ellipse,
        .mermaid .node:nth-child(4n+1) polygon {
            fill: #dbeafe !important;
            stroke: #2563eb !important;
        }
        
        .mermaid .node:nth-child(4n+2) rect,
        .mermaid .node:nth-child(4n+2) circle,
        .mermaid .node:nth-child(4n+2) ellipse,
        .mermaid .node:nth-child(4n+2) polygon {
            fill: #dcfce7 !important;
            stroke: #16a34a !important;
        }
        
        .mermaid .node:nth-child(4n+3) rect,
        .mermaid .node:nth-child(4n+3) circle,
        .mermaid .node:nth-child(4n+3) ellipse,
        .mermaid .node:nth-child(4n+3) polygon {
            fill: #fef3c7 !important;
            stroke: #d97706 !important;
        }
        
        .mermaid .node:nth-child(4n+4) rect,
        .mermaid .node:nth-child(4n+4) circle,
        .mermaid .node:nth-child(4n+4) ellipse,
        .mermaid .node:nth-child(4n+4) polygon {
            fill: #fce7f3 !important;
            stroke: #be185d !important;
        }
        
        .mermaid .node:nth-child(4n+1) .label {
            color: #1d4ed8 !important;
        }
        
        .mermaid .node:nth-child(4n+2) .label {
            color: #15803d !important;
        }
        
        .mermaid .node:nth-child(4n+3) .label {
            color: #92400e !important;
        }
        
        .mermaid .node:nth-child(4n+4) .label {
            color: #be185d !important;
        }
        
        /* High contrast mode for accessibility */
        @media (prefers-contrast: high) {
            .mermaid .node rect,
            .mermaid .node circle,
            .mermaid .node ellipse,
            .mermaid .node polygon {
                fill: white !important;
                stroke: black !important;
                stroke-width: 3px !important;
            }
            
            .mermaid .node .label {
                color: black !important;
                font-weight: 700 !important;
                font-size: 15px !important;
                text-shadow: none !important;
            }
            
            .mermaid .edgePath .path {
                stroke: black !important;
                stroke-width: 3px !important;
            }
            
            .mermaid .edgeLabel {
                background-color: white !important;
                color: black !important;
                font-weight: 700 !important;
                border: 2px solid black !important;
            }
        }

        @media (max-width: 1024px) {
            .toc-fixed {
                display: none;
            }
            .content-main {
                margin-left: 0;
            }
            .hero-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .mermaid-control-btn:not(.reset-zoom) {
                display: none;
            }
            .mermaid-controls {
                top: auto;
                bottom: 15px;
                right: 15px;
            }
        }
    </style>
  </head>

  <body>
    <!-- Fixed Table of Contents -->
    <nav class="toc-fixed">
      <div class="mb-6">
        <h3 class="font-bold text-lg text-gray-900 mb-4">目录</h3>
      </div>
      <div class="space-y-1">
        <a href="#hero" class="toc-link">概述</a>
        <a href="#introduction" class="toc-link">1. 引言</a>
        <a href="#introduction-challenges" class="toc-link sub">1.1 用户需求与挑战</a>
        <a href="#introduction-limitations" class="toc-link sub">1.2 标准库局限性</a>
        <a href="#overview" class="toc-link">2. 主流库概览</a>
        <a href="#overview-orjson" class="toc-link sub">2.1 orjson</a>
        <a href="#overview-jsonpickle" class="toc-link sub">2.2 jsonpickle</a>
        <a href="#overview-others" class="toc-link sub">2.3 simplejson/ujson</a>
        <a href="#overview-other-libs" class="toc-link sub">2.4 其他库</a>
        <a href="#solutions" class="toc-link">3. 序列化方案探讨</a>
        <a href="#solutions-orjson-custom" class="toc-link sub">3.1 orjson + 自定义</a>
        <a href="#solutions-jsonpickle-option" class="toc-link sub">3.2 jsonpickle选项</a>
        <a href="#solutions-custom-encoder" class="toc-link sub">3.3 自定义编码器</a>
        <a href="#data-types" class="toc-link">4. 数据类型处理策略</a>
        <a href="#compatibility" class="toc-link">5. 外部系统兼容性</a>
        <a href="#performance" class="toc-link">6. 性能考量</a>
        <a href="#conclusion" class="toc-link">7. 结论与推荐</a>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="content-main">
      <!-- Hero Section -->
      <section id="hero" class="bg-gradient-to-br from-blue-50 to-indigo-100 py-16">
        <div class="container mx-auto px-8">
          <div class="hero-grid max-w-7xl mx-auto">
            <div class="space-y-8">
              <div class="space-y-4">
                <h1 class="serif text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 leading-tight">
                  Python JSON序列化器
                  <span class="italic text-blue-600 block">深度调研</span>
                </h1>
                <p class="text-lg sm:text-xl text-gray-600 max-w-2xl">
                  探索Python生态中&#34;开箱即用&#34;的JSON序列化解决方案，分析主流库在多类型支持、性能与易用性方面的表现
                </p>
              </div>

              <!-- Key Highlights Grid -->
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-gray-200">
                  <div class="flex items-center space-x-3">
                    <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                    <div>
                      <h3 class="font-semibold text-gray-900">性能对比</h3>
                      <p class="text-sm text-gray-600">orjson领先4-12倍</p>
                    </div>
                  </div>
                </div>

                <div class="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-gray-200">
                  <div class="flex items-center space-x-3">
                    <i class="fas fa-cogs text-green-600 text-xl"></i>
                    <div>
                      <h3 class="font-semibold text-gray-900">类型支持</h3>
                      <p class="text-sm text-gray-600">datetime, numpy原生</p>
                    </div>
                  </div>
                </div>

                <div class="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-gray-200">
                  <div class="flex items-center space-x-3">
                    <i class="fas fa-shield-alt text-purple-600 text-xl"></i>
                    <div>
                      <h3 class="font-semibold text-gray-900">标准兼容</h3>
                      <p class="text-sm text-gray-600">RFC 8259规范</p>
                    </div>
                  </div>
                </div>

                <div class="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-gray-200">
                  <div class="flex items-center space-x-3">
                    <i class="fas fa-code text-orange-600 text-xl"></i>
                    <div>
                      <h3 class="font-semibold text-gray-900">配置复杂度</h3>
                      <p class="text-sm text-gray-600">自定义default函数</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex justify-center">
              <img src="https://kimi-web-img.moonshot.cn/img/p1-jj.byteimg.com/7719f0a16ab92134cb9883d920458fbeb3992a64.png" alt="Python JSON序列化技术概念图" class="w-full max-w-md rounded-xl shadow-lg" size="medium" aspect="wide" style="clipart" query="Python JSON序列化" referrerpolicy="no-referrer" data-modified="1" data-score="0.00"/>
            </div>
          </div>
        </div>
      </section>

      <!-- Content Sections -->
      <div class="container mx-auto px-8 py-16 body-text">
        <!-- Introduction -->
        <section id="introduction" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">1. 引言：Python JSON序列化的挑战与需求</h2>

          <div id="introduction-challenges" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">1.1. 用户对&#34;开箱即用&#34;和多类型支持的需求</h3>

            <div class="prose prose-lg max-w-none">
              <p class="text-gray-700 leading-relaxed mb-6">
                用户对Python中的JSON序列化器提出了明确且具有挑战性的需求，核心在于<strong>&#34;开箱即用&#34;</strong>和对<strong>&#34;各种数据类型&#34;</strong>的广泛支持。具体而言，&#34;开箱即用&#34;期望库本身内置丰富的默认序列化规则，能够直接处理常见的Python数据类型，而无需用户进行大量初始配置或编写冗长的自定义代码。
              </p>

              <div class="highlight-box">
                <h4 class="font-semibold text-lg mb-3">数据类型支持范围</h4>
                <ul class="space-y-2 text-gray-700">
                  <li><i class="fas fa-check text-green-500 mr-2"></i><strong>Python内置基本类型</strong>：int, str, list, dict, tuple, set, datetime</li>
                  <li><i class="fas fa-check text-green-500 mr-2"></i><strong>科学计算库类型</strong>：numpy数组, pandas DataFrame/Series</li>
                  <li><i class="fas fa-check text-green-500 mr-2"></i><strong>用户自定义类实例</strong>：通过class关键字定义的类</li>
                  <li><i class="fas fa-check text-green-500 mr-2"></i><strong>其他特定类型</strong>：函数、生成器、文件对象等</li>
                </ul>
              </div>
            </div>
          </div>

          <div id="introduction-limitations" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">1.2. 标准json模块的局限性</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                Python标准库中的
                <code>json</code>模块虽然提供了基本的JSON编码和解码功能，但在满足用户提出的&#34;开箱即用&#34;和多类型支持需求方面存在显著的局限性。
              </p>

              <div class="bg-red-50 border-l-4 border-red-400 p-6 rounded-r-lg">
                <h4 class="font-semibold text-red-800 mb-3">主要局限性</h4>
                <ul class="space-y-2 text-red-700">
                  <li>• 无法直接处理
                    <code>datetime.datetime</code>对象，抛出
                    <code>TypeError</code>
                  </li>
                  <li>• 不支持
                    <code>numpy.ndarray</code>等第三方库数据类型
                  </li>
                  <li>• 用户自定义类需要额外配置
                    <code>JSONEncoder</code>
                  </li>
                  <li>• 对特定类型（函数、生成器、文件对象）无默认方案</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Main Libraries Overview -->
        <section id="overview" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">2. 主流Python JSON库概览与比较</h2>

          <div class="comparison-table mb-12">
            <table>
              <thead>
                <tr>
                  <th>特性/库</th>
                  <th>
                    <code>orjson</code>
                  </th>
                  <th>
                    <code>jsonpickle</code>
                  </th>
                  <th>
                    <code>simplejson</code> / <code>ujson</code>
                  </th>
                  <th>
                    <code>nujson</code>
                  </th>
                  <th>
                    <code>marshmallow</code> / Pydantic
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="font-semibold">主要目标</td>
                  <td>极致性能，标准兼容</td>
                  <td>复杂对象图序列化</td>
                  <td>标准库替代，性能提升</td>
                  <td>针对
                    <code>numpy</code>优化
                  </td>
                  <td>数据验证与复杂对象序列化</td>
                </tr>
                <tr>
                  <td class="font-semibold">性能</td>
                  <td class="font-semibold text-green-600">非常高 (Rust实现)</td>
                  <td>相对较慢 (Python实现)</td>
                  <td>
                    <code>ujson</code>: 高 (C实现)
                    <br/>
                    <code>simplejson</code>: 中等
                  </td>
                  <td>针对
                    <code>numpy</code>场景优化
                  </td>
                  <td>中等，主要开销在数据验证</td>
                </tr>
                <tr>
                  <td class="font-semibold">内置多类型支持</td>
                  <td>
                    <code>datetime</code>,
                    <code>numpy</code> (需选项),
                    <code>UUID</code>,
                    <code>dataclass</code>
                  </td>
                  <td class="font-semibold text-green-600">几乎所有Python对象</td>
                  <td>主要标准类型，
                    <code>simplejson</code>支持
                    <code>Decimal</code>
                  </td>
                  <td>主要为
                    <code>numpy</code>
                  </td>
                  <td>通过Schema/Model定义支持多种类型</td>
                </tr>
                <tr>
                  <td class="font-semibold">自定义类型支持</td>
                  <td>通过
                    <code>default</code>函数
                  </td>
                  <td>自动处理，可配置处理器</td>
                  <td>通过
                    <code>default</code>函数
                  </td>
                  <td>需确认</td>
                  <td>核心功能，通过字段定义和验证规则</td>
                </tr>
                <tr>
                  <td class="font-semibold">输出纯净度</td>
                  <td class="font-semibold text-green-600">标准JSON (RFC 8259)</td>
                  <td>默认含额外类型信息，
                    <code>unpicklable=False</code>可改善
                  </td>
                  <td>标准JSON</td>
                  <td>需确认</td>
                  <td>标准JSON (通过Schema控制)</td>
                </tr>
                <tr>
                  <td class="font-semibold">安全性</td>
                  <td>良好</td>
                  <td class="font-semibold text-red-600">警告：不应用于不受信任的数据</td>
                  <td>良好</td>
                  <td>需确认</td>
                  <td>良好 (数据验证是核心)</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Library Details -->
          <div id="overview-orjson" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">2.1. orjson：高性能与部分内置类型支持</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                <code>orjson</code>是一个用Rust编写的Python JSON库，以其<strong>卓越的性能和对多种Python类型的原生支持</strong>而闻名。根据基准测试，<a href="https://dev.to/kanakos01/benchmarking-python-json-libraries-33bb" class="citation">orjson在序列化和反序列化速度上显著优于Python标准库的json模块</a>以及其他一些第三方库如
                <code>ujson</code>和
                <code>rapidjson</code>。
              </p>

              <div class="bg-blue-50 p-6 rounded-lg">
                <h4 class="font-semibold text-blue-800 mb-3">orjson原生支持的类型</h4>
                <ul class="space-y-2 text-blue-700">
                  <li><i class="fas fa-clock mr-2"></i>
                    <code>datetime.datetime</code>,
                    <code>datetime.date</code>,
                    <code>datetime.time</code> (RFC 3339格式)
                  </li>
                  <li><i class="fas fa-th mr-2"></i>
                    <code>numpy.ndarray</code> (通过
                    <code>OPT_SERIALIZE_NUMPY</code>选项)
                  </li>
                  <li><i class="fas fa-id-card mr-2"></i>
                    <code>UUID</code>实例
                  </li>
                  <li><i class="fas fa-code mr-2"></i>Python
                    <code>dataclass</code>对象
                  </li>
                </ul>
              </div>

              <div class="code-block">
                <pre><code class="language-python">import orjson
import datetime
import numpy as np

# 原生支持datetime
data = {&#34;timestamp&#34;: datetime.datetime.now()}
serialized = orjson.dumps(data)
print(serialized)  # b&#39;{&#34;timestamp&#34;:&#34;2023-10-26T14:30:00&#34;}&#39;

# 原生支持numpy数组 (需选项)
data = {&#34;array&#34;: np.array([1, 2, 3])}
serialized = orjson.dumps(data, option=orjson.OPT_SERIALIZE_NUMPY)
print(serialized)  # b&#39;{&#34;array&#34;:[1,2,3]}&#39;</code></pre>
              </div>
            </div>
          </div>

          <div id="overview-jsonpickle" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">2.2. jsonpickle：复杂对象序列化与额外信息问题</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                <code>jsonpickle</code>是一个旨在<strong>序列化和反序列化复杂Python对象图为JSON</strong>的库。与标准
                <code>json</code>模块不同，<a href="https://jsonpickle.readthedocs.io/" class="citation">jsonpickle的核心目标是能够处理几乎任何Python对象</a>，包括自定义类的实例、循环引用等复杂结构。
              </p>

              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-lg">
                <h4 class="font-semibold text-yellow-800 mb-3">注意事项</h4>
                <p class="text-yellow-700">
                  jsonpickle通过添加元数据（如
                  <code>&#34;py/object&#34;</code>字段）来实现完整序列化，但这会导致生成的JSON不再是严格的标准JSON。使用
                  <code>unpicklable=False</code>选项可以避免额外信息，但会牺牲反序列化能力。
                </p>
              </div>
            </div>
          </div>

          <div id="overview-others" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">2.3. simplejson / ujson：标准库的替代与性能提升</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                <code>simplejson</code>和
                <code>ujson</code> (UltraJSON) 是两个流行的Python JSON库，它们通常被视为对Python标准库
                <code>json</code>模块的替代品，主要目标是提供更好的性能和/或更广泛的特性支持。
              </p>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-green-800 mb-3">simplejson特点</h4>
                  <ul class="space-y-2 text-green-700 text-sm">
                    <li>• 标准库的PyPI向后移植</li>
                    <li>• 通常比标准库版本更新</li>
                    <li>• 支持
                      <code>Decimal</code>类型
                    </li>
                    <li>• API高度兼容</li>
                  </ul>
                </div>

                <div class="bg-blue-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-blue-800 mb-3">ujson特点</h4>
                  <ul class="space-y-2 text-blue-700 text-sm">
                    <li>• C语言实现，速度极快</li>
                    <li>• 旨在成为
                      <code>json</code>模块的直接替代品
                    </li>
                    <li>• 相同的API接口</li>
                    <li>• 在某些基准测试中表现优异</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div id="overview-other-libs" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">2.4. 其他库（如nujson, marshmallow, FastAPI集成）</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <div class="grid md:grid-cols-3 gap-6">
                <div class="bg-purple-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-purple-800 mb-3">nujson</h4>
                  <p class="text-purple-700 text-sm">
                    彩云天气团队开发，针对
                    <code>numpy</code>数据类型优化的JSON库，C语言层面的原生支持。
                  </p>
                </div>

                <div class="bg-indigo-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-indigo-800 mb-3">marshmallow</h4>
                  <p class="text-indigo-700 text-sm">
                    专注于数据验证和复杂对象序列化，通过Schema定义提供精确控制，但需要显式定义。
                  </p>
                </div>

                <div class="bg-teal-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-teal-800 mb-3">FastAPI + Pydantic</h4>
                  <p class="text-teal-700 text-sm">
                    现代Web框架集成方案，利用Python类型注解自动处理JSON序列化。
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Solutions Discussion -->
        <section id="solutions" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">3. &#34;开箱即用&#34;的多类型序列化方案探讨</h2>

          <div id="solutions-orjson-custom" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">3.1. orjson + 自定义default函数</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                <code>orjson</code>库本身已经提供了对多种Python内置类型和常用第三方库类型的良好支持。为了实现对更广泛数据类型的全面覆盖，结合使用自定义的
                <code>default</code>函数是一个强大且灵活的策略。
              </p>

              <div class="highlight-box">
                <h4 class="font-semibold text-lg mb-3">处理数据类型范围</h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <ul class="space-y-2">
                    <li><i class="fas fa-calendar text-blue-500 mr-2"></i>
                      <code>datetime</code>对象
                    </li>
                    <li><i class="fas fa-th text-green-500 mr-2"></i>
                      <code>numpy</code>标量与数组
                    </li>
                    <li><i class="fas fa-table text-purple-500 mr-2"></i>
                      <code>pandas</code> Series/DataFrame
                    </li>
                  </ul>
                  <ul class="space-y-2">
                    <li><i class="fas fa-code text-orange-500 mr-2"></i>自定义类实例</li>
                    <li><i class="fas fa-list text-teal-500 mr-2"></i>
                      <code>set</code>和
                      <code>tuple</code>类型
                    </li>
                    <li><i class="fas fa-coins text-yellow-500 mr-2"></i>
                      <code>Decimal</code>类型
                    </li>
                  </ul>
                </div>
              </div>

              <div class="code-block">
                <pre><code class="language-python">import orjson
import datetime
import numpy as np
import pandas as pd
from decimal import Decimal
from typing import Any

class CustomClass:
    def __init__(self, name: str, value: Any):
        self.name = name
        self.value = value

def custom_default(obj: Any) -&gt; Any:
    # 处理datetime对象
    if isinstance(obj, (datetime.date, datetime.time)):
        return obj.isoformat()
    
    # 处理numpy标量
    if isinstance(obj, np.generic):
        return obj.item()
    
    # 处理numpy数组
    if isinstance(obj, np.ndarray):
        return obj.tolist()
    
    # 处理pandas Series
    if isinstance(obj, pd.Series):
        return obj.to_dict()
    
    # 处理pandas DataFrame
    if isinstance(obj, pd.DataFrame):
        return obj.to_dict(orient=&#39;records&#39;)
    
    # 处理自定义类
    if hasattr(obj, &#39;__dict__&#39;):
        return obj.__dict__
    
    # 处理其他不支持的类型
    raise TypeError(f&#34;Object of type {type(obj)} is not JSON serializable&#34;)

# 使用自定义default函数
data = {
    &#34;timestamp&#34;: datetime.datetime.now(),
    &#34;numpy_array&#34;: np.array([1, 2, 3]),
    &#34;pandas_df&#34;: pd.DataFrame({&#39;A&#39;: [1, 2], &#39;B&#39;: [&#39;x&#39;, &#39;y&#39;]}),
    &#34;custom_obj&#34;: CustomClass(&#34;test&#34;, 123)
}

serialized = orjson.dumps(
    data, 
    default=custom_default,
    option=orjson.OPT_SERIALIZE_NUMPY
)</code></pre>
              </div>

              <div class="bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg">
                <h4 class="font-semibold text-blue-800 mb-3">配置要点</h4>
                <ul class="space-y-2 text-blue-700">
                  <li>•
                    <code>default</code>函数是核心，必须处理所有目标类型
                  </li>
                  <li>•
                    <code>option</code>参数可通过位掩码组合多个选项
                  </li>
                  <li>• 保持
                    <code>default</code>函数简洁高效以避免性能瓶颈
                  </li>
                  <li>•
                    <code>orjson.dumps()</code>返回
                    <code>bytes</code>而非
                    <code>str</code>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div id="solutions-jsonpickle-option" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">3.2. jsonpickle的unpicklable=False选项</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                <code>jsonpickle</code>提供了
                <code>unpicklable=False</code>选项，当使用此选项时，库会尝试生成一个不包含额外类型信息的、更接近标准JSON的输出。
              </p>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-green-800 mb-3">优势</h4>
                  <ul class="space-y-2 text-green-700 text-sm">
                    <li>• 强大的对象图遍历能力</li>
                    <li>• 生成更接近标准JSON的输出</li>
                    <li>• 适合Python内部通信场景</li>
                    <li>• 对复杂对象支持良好</li>
                  </ul>
                </div>

                <div class="bg-red-50 p-6 rounded-lg">
                  <h4 class="font-semibold text-red-800 mb-3">局限性</h4>
                  <ul class="space-y-2 text-red-700 text-sm">
                    <li>• 反序列化能力丧失</li>
                    <li>• 对复杂类型处理可能不理想</li>
                    <li>• 缺少自定义序列化逻辑</li>
                    <li>• 并非所有对象都能完美处理</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div id="solutions-custom-encoder" class="mb-12">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">3.3. 自定义JSONEncoder的实现</h3>

            <div class="prose prose-lg max-w-none space-y-6">
              <p class="text-gray-700 leading-relaxed">
                Python标准库中的
                <code>json</code>模块允许通过继承
                <code>json.JSONEncoder</code>类并重写其
                <code>default()</code>方法来创建自定义的JSON编码器。
              </p>

              <div class="code-block">
                <pre><code class="language-python">import json
from datetime import date, datetime, time
from decimal import Decimal
import numpy as np
import pandas as pd

class ExtendedJSONEncoder(json.JSONEncoder):
    def default(self, obj):
        # 处理datetime对象
        if isinstance(obj, (datetime, date, time)):
            return obj.isoformat()
        
        # 处理Decimal类型
        if isinstance(obj, Decimal):
            return str(obj)
        
        # 处理numpy数组
        if isinstance(obj, np.ndarray):
            return obj.tolist()
        
        # 处理numpy标量
        if isinstance(obj, np.generic):
            return obj.item()
        
        # 处理pandas DataFrame
        if isinstance(obj, pd.DataFrame):
            return obj.to_dict(orient=&#39;records&#39;)
        
        # 处理pandas Series
        if isinstance(obj, pd.Series):
            return obj.to_dict()
        
        # 处理自定义对象
        if hasattr(obj, &#39;__dict__&#39;):
            return obj.__dict__
        
        # 调用父类的default方法
        return super().default(obj)

# 使用示例
json_output = json.dumps(complex_data, cls=ExtendedJSONEncoder, indent=4)</code></pre>
              </div>
            </div>
          </div>
        </section>

        <!-- Data Types Section -->
        <section id="data-types" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">4. 特定数据类型序列化的处理策略</h2>

          <div class="grid md:grid-cols-2 gap-8 mb-12">
            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
              <h3 class="text-xl font-semibold mb-4 text-gray-800">Python内置类型</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <code class="text-sm">int, float</code>
                  <span class="text-green-600 text-sm">✓ 原生支持</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">str</code>
                  <span class="text-green-600 text-sm">✓ 原生支持</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">list, dict</code>
                  <span class="text-green-600 text-sm">✓ 原生支持</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">tuple</code>
                  <span class="text-green-600 text-sm">✓ 转为列表</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">set</code>
                  <span class="text-orange-600 text-sm">! 需转为列表</span>
                </div>
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
              <h3 class="text-xl font-semibold mb-4 text-gray-800">常用第三方类型</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <code class="text-sm">datetime</code>
                  <span class="text-blue-600 text-sm">✓ orjson原生支持</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">numpy.ndarray</code>
                  <span class="text-blue-600 text-sm">✓ orjson + 选项</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">pandas.DataFrame</code>
                  <span class="text-orange-600 text-sm">! 需to_dict()</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">Decimal</code>
                  <span class="text-orange-600 text-sm">! 需转为字符串</span>
                </div>
                <div class="flex justify-between items-center">
                  <code class="text-sm">UUID</code>
                  <span class="text-blue-600 text-sm">✓ orjson原生支持</span>
                </div>
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold text-lg mb-3">最佳实践建议</h4>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h5 class="font-semibold mb-2">datetime对象</h5>
                <p class="text-gray-700 text-sm">使用ISO 8601格式，orjson原生支持RFC 3339</p>
              </div>
              <div>
                <h5 class="font-semibold mb-2">numpy数组</h5>
                <p class="text-gray-700 text-sm">orjson + OPT_SERIALIZE_NUMPY或tolist()转换</p>
              </div>
              <div>
                <h5 class="font-semibold mb-2">pandas对象</h5>
                <p class="text-gray-700 text-sm">使用to_dict(orient=&#39;records&#39;)或to_json()方法</p>
              </div>
              <div>
                <h5 class="font-semibold mb-2">自定义类</h5>
                <p class="text-gray-700 text-sm">实现__dict__或自定义to_dict()方法</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Compatibility Section -->
        <section id="compatibility" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">5. 与微信小程序等外部系统的JSON兼容性</h2>

          <div class="prose prose-lg max-w-none space-y-6">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-r-lg">
              <h3 class="text-xl font-semibold text-yellow-800 mb-4">避免非标准JSON的额外类型信息</h3>
              <p class="text-yellow-700 leading-relaxed">
                在与微信小程序等外部系统进行数据交互时，确保JSON数据的兼容性至关重要。许多Python JSON序列化库在默认情况下会添加额外的元数据字段，如
                <code>&#34;py/object&#34;</code>，这会导致生成的JSON不再是严格的标准JSON。
              </p>
            </div>

            <div class="bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg">
              <h3 class="text-xl font-semibold text-green-800 mb-4">生成简洁、标准的JSON输出</h3>
              <p class="text-green-700 leading-relaxed mb-4">
                标准JSON (RFC 8259) 定义了一组有限的数据类型：对象（字典）、数组（列表）、字符串、数字、布尔值和null。理想情况下，转换应该产生尽可能简洁的JSON，避免不必要的嵌套或冗余信息。
              </p>
              <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded border">
                  <h4 class="font-semibold text-red-600 mb-2">不推荐的输出</h4>
                  <code class="text-sm text-gray-700">
                                    {&#34;py/object&#34;: &#34;__main__.Person&#34;, &#34;name&#34;: &#34;Alice&#34;, &#34;age&#34;: 30}
                                </code>
                </div>
                <div class="bg-white p-4 rounded border">
                  <h4 class="font-semibold text-green-600 mb-2">推荐的标准输出</h4>
                  <code class="text-sm text-gray-700">
                                    {&#34;name&#34;: &#34;Alice&#34;, &#34;age&#34;: 30}
                                </code>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Performance Section -->
        <section id="performance" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">6. 性能考量与最佳实践</h2>

          <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-blue-50 p-6 rounded-lg text-center">
              <i class="fas fa-tachometer-alt text-3xl text-blue-600 mb-3"></i>
              <h3 class="font-semibold text-blue-800 mb-2">orjson性能优势</h3>
              <p class="text-blue-700 text-sm">比其他库快4-50倍，内存使用仅为0.3倍</p>
            </div>

            <div class="bg-orange-50 p-6 rounded-lg text-center">
              <i class="fas fa-code text-3xl text-orange-600 mb-3"></i>
              <h3 class="font-semibold text-orange-800 mb-2">default函数影响</h3>
              <p class="text-orange-700 text-sm">Python层面的default函数可能成为性能瓶颈</p>
            </div>

            <div class="bg-green-50 p-6 rounded-lg text-center">
              <i class="fas fa-shield-alt text-3xl text-green-600 mb-3"></i>
              <h3 class="font-semibold text-green-800 mb-2">数据预处理</h3>
              <p class="text-green-700 text-sm">预清洗和类型检查提高稳定性</p>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold text-lg mb-4">性能优化最佳实践</h4>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h5 class="font-semibold mb-3">default函数优化</h5>
                <ul class="space-y-2 text-sm">
                  <li>• 保持逻辑简洁高效</li>
                  <li>• 优先使用isinstance进行类型检查</li>
                  <li>• 避免重复计算</li>
                  <li>• 利用库原生方法（tolist(), item()）</li>
                </ul>
              </div>
              <div>
                <h5 class="font-semibold mb-3">数据处理策略</h5>
                <ul class="space-y-2 text-sm">
                  <li>• 前置数据清洗和验证</li>
                  <li>• 批次处理大型数据集</li>
                  <li>• 缓存序列化结果</li>
                  <li>• 使用性能分析工具定位瓶颈</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Performance Comparison Diagram -->
          <div class="mt-12 bg-gray-50 p-8 rounded-lg">
            <h3 class="text-2xl font-semibold mb-6 text-center">序列化性能对比示意图</h3>
            <div class="mermaid-container">
              <div class="mermaid-controls">
                <button class="mermaid-control-btn zoom-in" title="放大">
                  <i class="fas fa-search-plus"></i>
                </button>
                <button class="mermaid-control-btn zoom-out" title="缩小">
                  <i class="fas fa-search-minus"></i>
                </button>
                <button class="mermaid-control-btn reset-zoom" title="重置">
                  <i class="fas fa-expand-arrows-alt"></i>
                </button>
                <button class="mermaid-control-btn fullscreen" title="全屏查看">
                  <i class="fas fa-expand"></i>
                </button>
              </div>
              <div class="mermaid" id="performance-chart">
                graph TD
                A[&#34;Python对象&#34;] --&gt; B{&#34;选择序列化方案&#34;}
                B --&gt;|&#34;高性能需求&#34;| C[&#34;orjson&#34;]
                B --&gt;|&#34;复杂对象&#34;| D[&#34;jsonpickle&#34;]
                B --&gt;|&#34;标准兼容&#34;| E[&#34;simplejson/ujson&#34;]
                B --&gt;|&#34;验证需求&#34;| F[&#34;marshmallow&#34;]

                C --&gt; G[&#34;默认支持类型&#34;]
                C --&gt; H[&#34;需要default函数&#34;]
                G --&gt; I[&#34;datetime, numpy, UUID&#34;]
                H --&gt; J[&#34;自定义类, pandas&#34;]

                D --&gt; K[&#34;unpicklable=False&#34;]
                D --&gt; L[&#34;完整类型信息&#34;]
                K --&gt; M[&#34;标准JSON输出&#34;]
                L --&gt; N[&#34;Python特有格式&#34;]

                style A fill:#e1f5fe
                style C fill:#c8e6c9
                style D fill:#fff3e0
                style E fill:#fce4ec
                style F fill:#f3e5f5
                style M fill:#e8f5e8
                style N fill:#ffebee
              </div>
            </div>
            <p class="text-center text-gray-600 mt-4">
              <i class="fas fa-info-circle mr-2"></i>
              此图展示了不同序列化方案的选择路径和特点，支持缩放和拖拽操作
            </p>
          </div>
        </section>

        <!-- Conclusion Section -->
        <section id="conclusion" class="mb-16">
          <h2 class="serif text-4xl font-bold mb-8 text-gray-900">7. 结论与推荐</h2>

          <div class="bg-gray-50 p-8 rounded-lg mb-8">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">当前&#34;开箱即用&#34;程度评估</h3>
            <p class="text-gray-700 leading-relaxed mb-6">
              综合来看，<strong>目前Python生态中尚无一个JSON序列化库能够完美满足所有&#34;开箱即用&#34;和多类型支持的需求</strong>。标准库
              <code>json</code>模块在类型支持上较为基础，需要大量自定义工作。
            </p>

            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-white p-6 rounded-lg border">
                <h4 class="font-semibold text-green-600 mb-3">已实现较好的支持</h4>
                <ul class="space-y-2 text-sm">
                  <li>• <strong>orjson</strong>：datetime, numpy数组, UUID, dataclass</li>
                  <li>• <strong>jsonpickle</strong>：几乎所有Python对象（但输出非标准）</li>
                  <li>• <strong>simplejson</strong>：Decimal类型支持</li>
                </ul>
              </div>

              <div class="bg-white p-6 rounded-lg border">
                <h4 class="font-semibold text-orange-600 mb-3">仍需改进的方面</h4>
                <ul class="space-y-2 text-sm">
                  <li>• 自定义类需要default函数或特殊处理</li>
                  <li>• pandas对象需要额外转换</li>
                  <li>• 复杂对象图的优雅处理</li>
                  <li>• 标准JSON输出的平衡</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="comparison-table mb-8">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">针对不同需求的推荐方案</h3>
            <table>
              <thead>
                <tr>
                  <th>需求场景</th>
                  <th>推荐方案</th>
                  <th>关键考量</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>追求极致性能，且主要处理标准类型</strong></td>
                  <td class="font-semibold text-blue-600">
                    <code>orjson</code>
                  </td>
                  <td>利用其Rust实现的性能优势，注意返回
                    <code>bytes</code>类型
                  </td>
                </tr>
                <tr>
                  <td><strong>处理多种自定义类型和复杂对象图</strong></td>
                  <td class="font-semibold text-purple-600">
                    <code>jsonpickle</code>
                  </td>
                  <td>强大的对象图处理能力，但注意安全性和输出纯净度</td>
                </tr>
                <tr>
                  <td><strong>生成标准JSON，愿意编写自定义逻辑</strong></td>
                  <td class="font-semibold text-green-600">
                    <code>orjson</code> + 自定义
                    <code>default</code>函数
                  </td>
                  <td>平衡性能与灵活性，通过default函数扩展类型支持</td>
                </tr>
                <tr>
                  <td><strong>严格的数据验证和复杂规则</strong></td>
                  <td class="font-semibold text-indigo-600">
                    <code>marshmallow</code>或Pydantic
                  </td>
                  <td>提供强大的数据校验和序列化控制，但需定义Schema</td>
                </tr>
                <tr>
                  <td><strong>大量numpy类型数据处理</strong></td>
                  <td class="font-semibold text-teal-600">
                    <code>nujson</code>或优化
                    <code>default</code>函数
                  </td>
                  <td>
                    <code>nujson</code>针对numpy优化，orjson需高效default函数
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold text-lg mb-4">最终推荐方案</h4>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h5 class="font-semibold mb-3 text-blue-600">追求极致性能与灵活配置</h5>
                <p class="text-gray-700 text-sm mb-3">
                  <code>orjson</code>配合自定义
                  <code>default</code>函数是目前较为理想的组合。提供卓越的序列化速度和对主流类型的原生支持。
                </p>
                <div class="bg-blue-50 p-3 rounded text-sm">
                  <strong>适用场景：</strong>高性能API服务、大规模数据处理、对外接口
                </div>
              </div>

              <div>
                <h5 class="font-semibold mb-3 text-purple-600">快速序列化复杂对象</h5>
                <p class="text-gray-700 text-sm mb-3">
                  <code>jsonpickle</code>（注意
                  <code>unpicklable=False</code>）适用于Python内部通信和对象持久化。
                </p>
                <div class="bg-purple-50 p-3 rounded text-sm">
                  <strong>适用场景：</strong>Python内部通信、缓存系统、复杂对象图处理
                </div>
              </div>
            </div>
          </div>

          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-8 rounded-lg">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">对未来更完善解决方案的展望</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <div class="flex items-start space-x-3">
                  <i class="fas fa-brain text-blue-600 mt-1"></i>
                  <div>
                    <h4 class="font-semibold text-gray-800">更智能的默认序列化</h4>
                    <p class="text-gray-600 text-sm">自动推断常见Python类型的合理JSON表示</p>
                  </div>
                </div>

                <div class="flex items-start space-x-3">
                  <i class="fas fa-puzzle-piece text-green-600 mt-1"></i>
                  <div>
                    <h4 class="font-semibold text-gray-800">模块化类型处理</h4>
                    <p class="text-gray-600 text-sm">清晰的插件系统，轻松注册自定义序列化逻辑</p>
                  </div>
                </div>
              </div>

              <div class="space-y-4">
                <div class="flex items-start space-x-3">
                  <i class="fas fa-shield-alt text-purple-600 mt-1"></i>
                  <div>
                    <h4 class="font-semibold text-gray-800">性能与安全并重</h4>
                    <p class="text-gray-600 text-sm">在追求性能的同时确保安全处理不受信任的输入</p>
                  </div>
                </div>

                <div class="flex items-start space-x-3">
                  <i class="fas fa-cogs text-orange-600 mt-1"></i>
                  <div>
                    <h4 class="font-semibold text-gray-800">丰富的配置选项</h4>
                    <p class="text-gray-600 text-sm">控制JSON输出格式，同时确保标准兼容性</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script>
        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'base',
            themeVariables: {
                // Primary colors with high contrast
                primaryColor: '#dbeafe',
                primaryTextColor: '#1e40af',
                primaryBorderColor: '#3b82f6',
                
                // Secondary colors for variety and contrast
                secondaryColor: '#dcfce7',
                secondaryTextColor: '#15803d',
                secondaryBorderColor: '#16a34a',
                
                // Tertiary colors
                tertiaryColor: '#fef3c7',
                tertiaryTextColor: '#92400e',
                tertiaryBorderColor: '#d97706',
                
                // Additional colors for better visual hierarchy
                quaternaryColor: '#fce7f3',
                quaternaryTextColor: '#be185d',
                quaternaryBorderColor: '#be185d',
                
                // Background and lines
                background: '#ffffff',
                mainBkg: '#dbeafe',
                secondBkg: '#dcfce7',
                tertiaryBkg: '#fef3c7',
                lineColor: '#6b7280',
                
                // Text styling for better readability
                textColor: '#1f2937',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                
                // Node styling
                nodeBorder: '#3b82f6',
                nodeTextColor: '#1e40af',
                
                // Edge styling
                edgeLabelBackground: 'rgba(255, 255, 255, 0.95)',
                edgeLabelText: '#374151',
                
                // Ensure high contrast for all text
                labelTextColor: '#1f2937',
                loopTextColor: '#1f2937',
                noteTextColor: '#1f2937',
                activationTextColor: '#1f2937'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 80,
                diagramPadding: 20
            },
            fontFamily: 'Inter, sans-serif',
            fontSize: 14,
            securityLevel: 'loose'
        });
        
        // Initialize Mermaid Controls for zoom and pan
        function initializeMermaidControls() {
            const containers = document.querySelectorAll('.mermaid-container');

            containers.forEach(container => {
            const mermaidElement = container.querySelector('.mermaid');
            let scale = 1;
            let isDragging = false;
            let startX, startY, translateX = 0, translateY = 0;

            // 触摸相关状态
            let isTouch = false;
            let touchStartTime = 0;
            let initialDistance = 0;
            let initialScale = 1;
            let isPinching = false;

            // Zoom controls
            const zoomInBtn = container.querySelector('.zoom-in');
            const zoomOutBtn = container.querySelector('.zoom-out');
            const resetBtn = container.querySelector('.reset-zoom');
            const fullscreenBtn = container.querySelector('.fullscreen');

            function updateTransform() {
                mermaidElement.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;

                if (scale > 1) {
                container.classList.add('zoomed');
                } else {
                container.classList.remove('zoomed');
                }

                mermaidElement.style.cursor = isDragging ? 'grabbing' : 'grab';
            }

            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                scale = Math.min(scale * 1.25, 4);
                updateTransform();
                });
            }

            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                scale = Math.max(scale / 1.25, 0.3);
                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }
                updateTransform();
                });
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
                });
            }

            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
                });
            }

            // Mouse Events
            mermaidElement.addEventListener('mousedown', (e) => {
                if (isTouch) return; // 如果是触摸设备，忽略鼠标事件

                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                mermaidElement.style.cursor = 'grabbing';
                updateTransform();
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging && !isTouch) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            document.addEventListener('mouseleave', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            // 获取两点之间的距离
            function getTouchDistance(touch1, touch2) {
                return Math.hypot(
                touch2.clientX - touch1.clientX,
                touch2.clientY - touch1.clientY
                );
            }

            // Touch Events - 触摸事件处理
            mermaidElement.addEventListener('touchstart', (e) => {
                isTouch = true;
                touchStartTime = Date.now();

                if (e.touches.length === 1) {
                // 单指拖动
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;

                } else if (e.touches.length === 2) {
                // 双指缩放
                isPinching = true;
                isDragging = false;

                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = getTouchDistance(touch1, touch2);
                initialScale = scale;
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchmove', (e) => {
                if (e.touches.length === 1 && isDragging && !isPinching) {
                // 单指拖动
                const touch = e.touches[0];
                translateX = touch.clientX - startX;
                translateY = touch.clientY - startY;
                updateTransform();

                } else if (e.touches.length === 2 && isPinching) {
                // 双指缩放
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = getTouchDistance(touch1, touch2);

                if (initialDistance > 0) {
                    const newScale = Math.min(Math.max(
                    initialScale * (currentDistance / initialDistance),
                    0.3
                    ), 4);
                    scale = newScale;
                    updateTransform();
                }
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchend', (e) => {
                // 重置状态
                if (e.touches.length === 0) {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                // 延迟重置isTouch，避免鼠标事件立即触发
                setTimeout(() => {
                    isTouch = false;
                }, 100);
                } else if (e.touches.length === 1 && isPinching) {
                // 从双指变为单指，切换为拖动模式
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                }

                updateTransform();
            });

            mermaidElement.addEventListener('touchcancel', (e) => {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                setTimeout(() => {
                isTouch = false;
                }, 100);

                updateTransform();
            });

            // Enhanced wheel zoom with better center point handling
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const rect = container.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.min(Math.max(scale * delta, 0.3), 4);

                // Adjust translation to zoom towards center
                if (newScale !== scale) {
                const scaleDiff = newScale / scale;
                translateX = translateX * scaleDiff;
                translateY = translateY * scaleDiff;
                scale = newScale;

                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }

                updateTransform();
                }
            });

            // Initialize display
            updateTransform();
            });
        }

        // Smooth scrolling for TOC links
        document.querySelectorAll('.toc-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Active TOC link highlighting
        function updateActiveTocLink() {
            const sections = document.querySelectorAll('section[id], div[id]');
            const tocLinks = document.querySelectorAll('.toc-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', updateActiveTocLink);
        
        // Initialize mermaid controls after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for mermaid to render
            setTimeout(() => {
                initializeMermaidControls();
            }, 1000);
        });
    </script>
  

</body></html>